<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CricScanner Live</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0d1117;
      color: #e5e7eb;
      font-family: 'Inter', sans-serif;
    }
    .tab-active { background-color: #10b981; color: white; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center py-10 px-4">
  <header class="w-full max-w-5xl text-center mb-8">
    <h1 class="text-3xl font-bold text-green-400 flex justify-center items-center gap-2">
      üèè CricScanner Live
    </h1>
  </header>

  <div id="cacheNotice" class="hidden text-yellow-400 text-sm mt-2 text-center">
    ‚ö†Ô∏è Showing last saved data ‚Äî live updates may be delayed due to API limit.
  </div>

  <section class="w-full max-w-5xl mt-6">
    <h2 class="text-xl font-semibold mb-2">ALL Tournaments</h2>
    <p id="tournamentList" class="text-gray-400 text-sm">No tournaments available right now.</p>
  </section>

  <section class="w-full max-w-5xl mt-8">
    <h2 class="text-xl font-semibold mb-4">Matches</h2>

    <div class="flex gap-3 mb-6">
      <button id="liveTab" class="px-4 py-1 rounded-full border border-gray-600 tab-active">Live</button>
      <button id="upcomingTab" class="px-4 py-1 rounded-full border border-gray-600">Upcoming</button>
      <button id="recentTab" class="px-4 py-1 rounded-full border border-gray-600">Recent</button>
    </div>

    <div id="matchList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    <p id="noMatchesMsg" class="text-center text-gray-500 mt-6 hidden">No matches available right now.</p>
  </section>

  <script src="/js/auto-updater.js"></script>
  <script>
    const matchListEl = document.getElementById("matchList");
    const noMatchesMsg = document.getElementById("noMatchesMsg");

    const tabs = {
      live: document.getElementById("liveTab"),
      upcoming: document.getElementById("upcomingTab"),
      recent: document.getElementById("recentTab"),
    };
    let activeTab = "live";

    Object.entries(tabs).forEach(([key, btn]) => {
      btn.addEventListener("click", () => {
        activeTab = key;
        Object.values(tabs).forEach(b => b.classList.remove("tab-active"));
        btn.classList.add("tab-active");
        renderMatches();
      });
    });

    function renderMatches() {
      const data = JSON.parse(localStorage.getItem("cricscanner_matches") || "[]");
      matchListEl.innerHTML = "";

      const filtered = data.filter(m => {
        const s = (m.status || "").toLowerCase();
        if (activeTab === "live") return /(live|innings|stumps|progress|day|lunch|tea|break)/i.test(s);
        if (activeTab === "upcoming") return /(upcoming|not started|scheduled|start)/i.test(s);
        if (activeTab === "recent") return /(completed|finished|result|end)/i.test(s);
        return false;
      });

      if (filtered.length === 0) {
        noMatchesMsg.classList.remove("hidden");
        return;
      } else {
        noMatchesMsg.classList.add("hidden");
      }

      filtered.forEach(match => {
        const homeLogo = match.teamInfo?.[0]?.img || "https://upload.wikimedia.org/wikipedia/commons/e/e0/Cricket_ball_icon.png";
        const awayLogo = match.teamInfo?.[1]?.img || "https://upload.wikimedia.org/wikipedia/commons/e/e0/Cricket_ball_icon.png";
        const home = match.teamInfo?.[0]?.name || match.teams?.[0] || "Team A";
        const away = match.teamInfo?.[1]?.name || match.teams?.[1] || "Team B";
        const scoreHome = match.score?.[0]?.r ? `${match.score[0].r}/${match.score[0].w}` : "";
        const scoreAway = match.score?.[1]?.r ? `${match.score[1].r}/${match.score[1].w}` : "";

        const card = document.createElement("div");
        card.className = "bg-[#161b22] p-4 rounded-2xl shadow hover:shadow-lg transition";

        card.innerHTML = `
          <div class="flex justify-between items-center text-xs text-gray-400 mb-2">
            <span class="text-red-400 font-bold uppercase">${match.status || "LIVE"}</span>
            <span>${match.matchType?.toUpperCase() || ""}</span>
          </div>
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <img src="${homeLogo}" alt="logo" class="w-6 h-6 rounded-full" />
              <span class="font-semibold">${home}</span>
            </div>
            <span class="text-sm font-medium">${scoreHome}</span>
          </div>
          <div class="flex items-center justify-between mt-2">
            <div class="flex items-center gap-2">
              <img src="${awayLogo}" alt="logo" class="w-6 h-6 rounded-full" />
              <span class="font-semibold">${away}</span>
            </div>
            <span class="text-sm font-medium">${scoreAway}</span>
          </div>
          <p class="text-xs text-gray-400 mt-3">${match.text || ""}</p>
          <button onclick="viewScorecard('${match.id}')" class="mt-3 bg-green-500 text-white w-full py-2 rounded-lg font-semibold text-sm hover:bg-green-600">
            View Full Scorecard
          </button>
        `;

        matchListEl.appendChild(card);
      });
    }

    function viewScorecard(id) {
      if (!id) return alert("Match ID not available!");
      window.location.href = `/scorecard.html?id=${id}`;
    }

    window.addEventListener("storage", e => {
      if (e.key === "cricscanner_matches") renderMatches();
    });

    renderMatches();
  </script>
</body>
</html>
